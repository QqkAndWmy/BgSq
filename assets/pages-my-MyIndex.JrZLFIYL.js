import{_ as e,g as a,r as l,d as s,e as t,b as o,h as n,o as u,w as i,a as c,i as r,m as d,t as f,n as m,E as p,A as _,L as k,B as v,c as y,F as g,k as x,l as h,f as w,q as b,y as C,s as L,M as j,N as A,O as q,P as U,D as F,Q as I}from"./index-BpbZ6T0G.js";import{_ as R,a as V,U as M}from"./Update.DtzMR81h.js";import{_ as P}from"./uni-forms-item.B8Sdv0Rv.js";import{_ as E}from"./uni-data-checkbox.GjnEvMPD.js";import{_ as N}from"./uni-easyinput.DrQNDsNM.js";import{_ as T}from"./uni-forms.iM4Ojt5W.js";const $=e({__name:"MyEditInfo",emits:["reload"],setup(e,{expose:p,emit:_}){const{proxy:k}=a(),v=l({}),y=l(),g={sex:{rules:[{required:!0,errorMessage:"请选择性别"}]},password:{rules:[{maxLength:18,errorMessage:"密码长度不能超过18个字符"},{pattern:/^(?=.*\d)(?=.*[a-zA-Z])[\da-zA-Z~!@#$%^&*_]{8,}$/,errorMessage:"密码必须含有数字字母或特殊字符长度不能少于8位"}]},rePassword:{rules:[{validateFunction:(e,a,l,s)=>(""!=a&&a!==v.value.password&&s("两次输入的密码不一致"),!0)}]}},x=_,h=()=>{y.value.validate((async(e,a)=>{if(e)return;const l=Object.assign({},v.value);await k.Request({url:k.Api.updateUserInfo,params:l})&&(k.Message.success("修改成功!"),w.value.close(),x("reload"))}))},w=l();return p({show:e=>{w.value.show(),m((()=>{v.value=Object.assign({},e)}))}}),(e,a)=>{const l=r,m=s(t("uni-forms-item"),P),p=s(t("uni-data-checkbox"),E),_=s(t("uni-easyinput"),N),k=s(t("uni-forms"),T),x=o("Dialog");return u(),n(l,null,{default:i((()=>[c(x,{title:"修改信息",ref_key:"dialogRef",ref:w,showCancel:!0,okFun:h,okText:"确定"},{default:i((()=>[c(k,{ref_key:"formDataRef",ref:y,model:v.value,rules:g,"label-width":70,"label-align":"right"},{default:i((()=>[c(m,{name:"nickName",label:"昵称"},{default:i((()=>[c(l,{class:"nick-name"},{default:i((()=>[d(f(v.value.nickName),1)])),_:1})])),_:1}),c(m,{name:"sex",label:"性别"},{default:i((()=>[c(p,{modelValue:v.value.sex,"onUpdate:modelValue":a[0]||(a[0]=e=>v.value.sex=e),localdata:[{text:"男",value:1},{text:"女",value:0}]},null,8,["modelValue"])])),_:1}),c(m,{name:"password",label:"密码"},{default:i((()=>[c(_,{type:"password",modelValue:v.value.password,"onUpdate:modelValue":a[1]||(a[1]=e=>v.value.password=e),placeholder:"请输入密码",prefixIcon:"locked",trim:!0},null,8,["modelValue"])])),_:1}),c(m,{name:"rePassword",label:"重复密码"},{default:i((()=>[c(l,null,{default:i((()=>[c(_,{type:"password",modelValue:v.value.rePassword,"onUpdate:modelValue":a[2]||(a[2]=e=>v.value.rePassword=e),placeholder:"请输入密码",prefixIcon:"locked",trim:!0},null,8,["modelValue"])])),_:1}),c(l,{class:"tips"},{default:i((()=>[d("不输入密码表示不修改密码")])),_:1})])),_:1})])),_:1},8,["model"])])),_:1},512)])),_:1})}}},[["__scopeId","data-v-33590e51"]]),O=e({__name:"MyIndex",setup(e){const{proxy:m}=a(),P=l(),E=e=>{if(e.needLogin){const e=_(k.token.key);if(""==e||null==e)return void L({url:"/pages/account/LoginAndRegister"})}e.clickFun?e.clickFun():L({url:e.path})},N=l([{text:"八股文",icon:"icon-question",path:"/pages/my/CollectQuestion",color:"#00ffff",needLogin:!0},{text:"考题",icon:"icon-exam1",path:"/pages/my/CollectExamQuestion",color:"#55ff7f",needLogin:!0},{text:"分享",icon:"icon-share",path:"/pages/my/CollectShare",color:"#ffaaff",needLogin:!0}]),T=l([{text:"我的考试",icon:"icon-exam1",color:"#ff007f",path:"/pages/my/ExamList",needLogin:!0},{text:"我的错题集",icon:"icon-wrong-question",color:"#ff55ff",path:"/pages/my/WrongExamQuestion",needLogin:!0}]),O=l([{text:"问题反馈",icon:"icon-email",path:"/pages/my/Feedback",color:"#00aa00",needLogin:!0},{text:"检查更新",icon:"icon-update",color:"#ff0000",needLogin:!1,clickFun:()=>{P.value.checkUpdate(!0)}}]),D=()=>{m.Confirm("确定要退出吗？",(()=>{I(k.token.key),B.value={}}))},Q=()=>{L({url:"/pages/account/LoginAndRegister"})},z=()=>{j({mediaType:["image"],sourceType:["camera","album"],sizeType:["compressed"],count:1,success:function(e){let a={token:_(k.token.key)};A(),q({url:m.Api.domain+m.Api.uploadAvatar,filePath:e.tempFilePaths[0],name:"file",header:a,complete:e=>{U(),S(),F(k.avatar.key,(new Date).getTime())}})}})},Z=l(0),B=l({}),S=async()=>{let e=await m.Request({url:m.Api.getUserInfo,showLoading:!1});e&&(B.value=e.data||{},Z.value=_(k.avatar.key))},W=l(),G=()=>{W.value.show(B.value)};return p((()=>{S()})),(e,a)=>{const l=o("Navbar"),p=r,_=x,k=s(t("uni-grid-item"),R),L=s(t("uni-grid"),V);return u(),n(p,null,{default:i((()=>[c(l,{showLeft:!1,title:"个人中心"}),c(p,{class:"user-body"},{default:i((()=>[c(p,{class:"base-info"},{default:i((()=>[c(p,{class:"avatar"},{default:i((()=>[0===Object.keys(B.value).length?(u(),n(p,{key:0,onClick:Q,class:"avatar-no-img no-login"},{default:i((()=>[d("未登录")])),_:1})):(u(),y(g,{key:1},[B.value.avatar?(u(),n(_,{key:0,class:"avatar-img",onClick:z,src:`${h(m).Api.domain}${h(m).Api.imageUrl}${B.value.avatar}?${Z.value}`,mode:"aspectFit"},null,8,["src"])):(u(),n(p,{key:1,class:"avatar-no-img",onClick:z},{default:i((()=>[d(f(B.value.nickName.split("")[0]),1)])),_:1}))],64))])),_:1}),Object.keys(B.value).length>0?(u(),n(p,{key:0,class:"user-info"},{default:i((()=>[c(p,{class:"nick-name"},{default:i((()=>[c(p,null,{default:i((()=>[d(f(B.value.nickName),1)])),_:1}),c(p,{class:"iconfont icon-edit",onClick:G}),c(p,{class:"iconfont icon-logout",onClick:D})])),_:1}),c(p,{class:"join-time"},{default:i((()=>[c(p,{class:"sex"},{default:i((()=>[null==B.value.sex?(u(),n(p,{key:0},{default:i((()=>[d("未知")])),_:1})):v("",!0),1==B.value.sex?(u(),n(p,{key:1},{default:i((()=>[d("男")])),_:1})):v("",!0),0==B.value.sex?(u(),n(p,{key:2},{default:i((()=>[d("女")])),_:1})):v("",!0)])),_:1}),c(p,{class:"line"},{default:i((()=>[d("|")])),_:1}),d(" "+f(h(m).Utils.dateformat(B.value.joinTime))+" 加入 ",1)])),_:1})])),_:1})):v("",!0)])),_:1}),c(p,{class:"part-list"},{default:i((()=>[c(p,{class:"part-title collect"},{default:i((()=>[d("收藏")])),_:1}),c(p,{class:"item-list"},{default:i((()=>[c(L,{column:3,"show-border":!1,square:!1},{default:i((()=>[(u(!0),y(g,null,w(N.value,((e,a)=>(u(),n(k,{index:a,key:a,onClick:a=>E(e)},{default:i((()=>[c(p,{class:"item"},{default:i((()=>[c(p,{class:C(["iconfont",e.icon]),style:b({color:e.color})},null,8,["class","style"]),c(p,{class:"text"},{default:i((()=>[d(f(e.text),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["index","onClick"])))),128))])),_:1})])),_:1})])),_:1}),c(p,{class:"part-list"},{default:i((()=>[c(p,{class:"part-title collect"},{default:i((()=>[d("积累")])),_:1}),c(p,{class:"item-list"},{default:i((()=>[c(L,{column:2,"show-border":!1,square:!1},{default:i((()=>[(u(!0),y(g,null,w(T.value,((e,a)=>(u(),n(k,{index:a,key:a,onClick:a=>E(e)},{default:i((()=>[c(p,{class:"item"},{default:i((()=>[c(p,{class:C(["iconfont",e.icon]),style:b({color:e.color})},null,8,["class","style"]),c(p,{class:"text"},{default:i((()=>[d(f(e.text),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["index","onClick"])))),128))])),_:1})])),_:1})])),_:1}),c(p,{class:"part-list"},{default:i((()=>[c(p,{class:"part-title collect"},{default:i((()=>[d("服务")])),_:1}),c(p,{class:"item-list"},{default:i((()=>[c(L,{column:2,"show-border":!1,square:!1},{default:i((()=>[(u(!0),y(g,null,w(O.value,((e,a)=>(u(),n(k,{index:a,key:a,onClick:a=>E(e)},{default:i((()=>[c(p,{class:"item"},{default:i((()=>[c(p,{class:C(["iconfont",e.icon]),style:b({color:e.color})},null,8,["class","style"]),c(p,{class:"text"},{default:i((()=>[d(f(e.text),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["index","onClick"])))),128))])),_:1})])),_:1})])),_:1})])),_:1}),c($,{ref_key:"myEditInfoRef",ref:W,onReload:S},null,512),c(M,{ref_key:"updateRef",ref:P},null,512)])),_:1})}}},[["__scopeId","data-v-4dc4ac5f"]]);export{O as default};
