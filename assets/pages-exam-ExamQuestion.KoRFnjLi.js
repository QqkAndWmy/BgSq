import{g as e,r as a,d as t,e as s,b as l,h as u,o,w as n,a as r,i,_ as d,H as f,I as c,m as v,t as m,J as p,z as _,A as h,L as w,S as x,q as y,c as k,F as g,f as q,j as C,B as I,C as A,y as E,K as L}from"./index-BpbZ6T0G.js";import{_ as j}from"./uni-forms.iM4Ojt5W.js";import{E as b}from"./ExamQuestionItem.SgsDmbS0.js";import{_ as R}from"./uni-easyinput.DrQNDsNM.js";import{_ as V}from"./uni-forms-item.B8Sdv0Rv.js";import"./uni-data-checkbox.GjnEvMPD.js";import"./uni-rate.BSKBJ-Oq.js";import"./uv-parse.BoNYvFCG.js";const T={__name:"ExamPostModel",emits:["postExam"],setup(d,{expose:f,emit:c}){const{proxy:v}=e(),m=a({}),p=a(),_={remark:{rules:[{required:!0,errorMessage:"请输入内容"}]}},h=c,w=()=>{p.value.validate(((e,a)=>{e||h("postExam",m.value.remark)}))},x=a();return f({show:()=>{x.value.show()},close:()=>{x.value.close()}}),(e,a)=>{const d=t(s("uni-easyinput"),R),f=t(s("uni-forms-item"),V),c=t(s("uni-forms"),j),v=l("Dialog"),h=i;return o(),u(h,null,{default:n((()=>[r(v,{title:"提交考试",ref_key:"postExamRef",ref:x,showCancel:!0,okFun:w,okText:"提交考试"},{default:n((()=>[r(c,{ref_key:"formDataRef",ref:p,model:m.value,"label-width":"0",rules:_},{default:n((()=>[r(f,{name:"remark"},{default:n((()=>[r(d,{modelValue:m.value.remark,"onUpdate:modelValue":a[0]||(a[0]=e=>m.value.remark=e),placeholder:"请输入备注",trim:!0},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},512)])),_:1})}}},Q=d({__name:"TimerCountUp",setup(t,{expose:s}){const{proxy:l}=e(),d=a(0),p=f((()=>d.value%60)),_=f((()=>parseInt(d.value/60))),h=f((()=>parseInt(d.value/3600))),w=e=>e<10?"0"+e:e,x=a(),y=()=>{x.value&&clearInterval(x.value)};return s({start:()=>{x.value=setInterval((()=>{d.value++}),1e3)},stop:y}),c((()=>{y()})),(e,a)=>{const t=i;return o(),u(t,{class:"time"},{default:n((()=>[r(t,null,{default:n((()=>[v(m(w(h.value)),1)])),_:1}),r(t,null,{default:n((()=>[v(":")])),_:1}),r(t,null,{default:n((()=>[v(m(w(_.value)),1)])),_:1}),r(t,null,{default:n((()=>[v(":")])),_:1}),r(t,null,{default:n((()=>[v(m(w(p.value)),1)])),_:1})])),_:1})}}},[["__scopeId","data-v-17ceaf70"]]),U=d({__name:"ExamQuestion",setup(d){const{proxy:c}=e(),R=p(),V=a();_((e=>{V.value=e.examId,D()}));const U=a({}),H=a(),D=async()=>{let e=await c.Request({url:c.Api.getExamQuestion,params:{examId:V.value}});if(!e)return;const a=e.data,t=e.data.examQuestionList;let s=0,l=h(w.exam_answer.key);t.forEach((e=>{if(0==a.status){if(e.userAnswer=void 0,""!==l){const t=l[a.examId];null!=t&&(e.userAnswer=t[e.questionId])}}else 1==a.status&&2==e.questionType&&(e.userAnswer=e.userAnswer.split(","));1==e.answerResult&&s++})),a.totalCount=t.length,a.rightCount=s,a.wrongCount=t.length-s,U.value=a,N.value.questionList=t,z.value=t[0],0==e.data.status&&H.value.show()},F=a(),M=async()=>{await c.Request({url:c.Api.startExam,params:{examId:V.value}})&&(H.value.close(),F.value.start())},P=f((()=>{const{statusBar:e,navBarHeight:a,screenHeight:t}=R.getInfo();return t-e-a-50})),B=a(0),z=a({}),J=e=>{const{current:a,source:t}=e.detail;B.value=a,z.value=N.value.questionList[a]},K=e=>{z.value.haveCollect=e},N=a({questionList:[]}),S=a(),W=a(),G=()=>{S.value.validate((async(e,a)=>{if(e){const e=N.value.questionList;for(let a=0;a<e.length;a++){const t=e[a];if(null==t.userAnswer||0==t.userAnswer.length){B.value=a;break}}}else W.value.show()}))},O=async e=>{let a={examId:V.value};const t=[];N.value.questionList.forEach((e=>{let a=e.userAnswer;2==e.questionType&&(a=a.sort().join(",")),t.push({userAnswer:a,questionId:e.questionId})})),a.appExamQuestionList=t,a.remark=e,await c.Request({url:c.Api.postExam,params:a,dataType:"json"})&&(c.Message.success("考试提交成功"),W.value.close(),F.value.stop(),D())},X=()=>{L()},Y=a(),Z=()=>{Y.value.show()},$=f((()=>{const{screenWidth:e}=R.getInfo();return e/6}));return(e,a)=>{const d=i,f=l("Navbar"),c=C,p=x,_=t(s("uni-forms"),j),h=l("Footer"),w=A,L=l("Dialog"),R=l("Popup");return o(),u(d,null,{default:n((()=>[r(f,{showLeft:!1},{default:n((()=>[r(d,{class:"timer"},{default:n((()=>[r(d,{class:"title"},{default:n((()=>[v("耗时")])),_:1}),r(d,null,{default:n((()=>[0==U.value.status?(o(),u(Q,{key:0,ref_key:"timerCountUpRef",ref:F},null,512)):(o(),u(d,{key:1},{default:n((()=>[v(m(U.value.useTimeMin)+"分钟",1)])),_:1}))])),_:1})])),_:1})])),_:1}),r(d,{class:"question-list"},{default:n((()=>[r(_,{ref_key:"formDataRef",ref:S,modelValue:N.value},{default:n((()=>[r(p,{current:B.value,class:"swiper",onChange:J,style:y({height:P.value+"px"})},{default:n((()=>[(o(!0),k(g,null,q(N.value.questionList,((e,a)=>(o(),u(c,{key:a},{default:n((()=>[r(b,{data:e,index:a,showAnswer:1==U.value.status,modelValue:N.value.questionList[a].userAnswer,"onUpdate:modelValue":e=>N.value.questionList[a].userAnswer=e,showHtml:a==B.value,height:P.value},null,8,["data","index","showAnswer","modelValue","onUpdate:modelValue","showHtml","height"])])),_:2},1024)))),128))])),_:1},8,["current","style"])])),_:1},8,["modelValue"])])),_:1}),r(h,{objectId:z.value.questionId+"",haveCollect:z.value.haveCollect,collectType:2,onUpdateCollect:K},{default:n((()=>[r(d,{class:"footer"},{default:n((()=>[r(d,{class:"btn-panel"},{default:n((()=>[0==U.value.status?(o(),u(d,{key:0,class:"btn",onClick:G},{default:n((()=>[v("交卷")])),_:1})):(o(),u(d,{key:1,class:"btn",onClick:X},{default:n((()=>[v("返回")])),_:1}))])),_:1}),1==U.value.status?(o(),k(g,{key:0},[r(d,{class:"iconfont icon-ok"},{default:n((()=>[v(m(U.value.rightCount),1)])),_:1}),r(d,{class:"iconfont icon-wrong"},{default:n((()=>[v(m(U.value.wrongCount),1)])),_:1})],64)):I("",!0),r(d,{class:"iconfont icon-more",onClick:Z},{default:n((()=>[v(m(B.value+1)+"/"+m(U.value.totalCount),1)])),_:1})])),_:1})])),_:1},8,["objectId","haveCollect"]),r(L,{title:"开始考试",ref_key:"startExamRef",ref:H,showCancel:!1,okFun:M,okText:"开始答题"},{default:n((()=>[r(d,{class:"question-total"},{default:n((()=>[r(w,null,{default:n((()=>[v("共")])),_:1}),r(w,{class:"count"},{default:n((()=>[v(m(U.value.examQuestionList.length),1)])),_:1}),r(w,null,{default:n((()=>[v("题")])),_:1})])),_:1}),r(d,null,{default:n((()=>[v("开始考试后不要将应用切换到后台")])),_:1}),r(d,null,{default:n((()=>[v("点击“开始答题”开始计时")])),_:1})])),_:1},512),r(T,{ref_key:"postExamRef",ref:W,onPostExam:O},null,512),r(R,{ref_key:"questionPopupRef",ref:Y},{default:n((()=>[r(d,{class:"pop-question-list"},{default:n((()=>[(o(!0),k(g,null,q(N.value.questionList,((e,a)=>(o(),u(d,{class:"question-item",style:y({width:$.value+"px",height:$.value+"px"})},{default:n((()=>[r(d,{class:E(["item-inner",B.value==a?"active":"",e.userAnswer?"answered":""]),style:y({width:$.value-20+"px",height:$.value-20+"px","border-radius":($.value-20)/2+"px"}),onClick:e=>(e=>{B.value=e,Y.value.close()})(a)},{default:n((()=>[v(m(a+1),1)])),_:2},1032,["class","style","onClick"])])),_:2},1032,["style"])))),256))])),_:1})])),_:1},512)])),_:1})}}},[["__scopeId","data-v-3c115437"]]);export{U as default};
